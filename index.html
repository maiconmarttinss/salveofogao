<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Salve o Fog√£o das vendas!</title>
<style>
  :root{ --bg:#0d1117; --panel:#151b23; --line:#232a34; --fg:#e6edf3; --mut:#9aa0a6; --acc:#3ddc97; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1400px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:12px;align-items:center}
  h1{margin:0;font-size:clamp(18px,3.5vw,26px)}
  .hud{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .left,.right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  label{color:var(--mut);font-size:14px}
  select,button{background:var(--panel);color:var(--fg);border:1px solid var(--line);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
  button:hover{filter:brightness(1.06)}
  .score{color:var(--mut);font-weight:600}
  .badge{background:#202938;border:1px solid #2b3442;border-radius:999px;padding:4px 10px;color:var(--mut);font-size:12px}

  canvas{
    width:100%;
    max-width:1280px;
    aspect-ratio:16/9;
    background:#0f1622;
    border:1px solid var(--line);
    border-radius:16px;
    display:block;
  }

  .help{color:var(--mut);font-size:13px;line-height:1.5}
  .touch{display:flex;gap:8px;margin-top:6px}
  .touch .btn{flex:1}

  @media (max-width: 768px){
    .wrap{max-width:none;padding:12px}
    canvas{max-width:100vw}
    h1{font-size:18px}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>SALVE O FOG√ÉO DAS VENDAS PRO FOREST!</h1>
  <div class="hud">
    <div class="left">
      <span class="badge">Espa√ßo / ‚Üë / Enter / clique / toque</span>
      <label for="diff">Dificuldade:</label>
      <select id="diff">
        <option value="easy">F√°cil</option>
        <option value="normal" selected>M√©dio</option>
        <option value="hard">Dif√≠cil</option>
      </select>
      <button id="start" class="btn">‚ñ∂Ô∏è Jogar / Reiniciar</button>
      <button id="pause" class="btn">‚è∏Ô∏è Pausar</button>
      <button id="mute"  class="btn">üîä Som: ON</button>
    </div>
    <div class="right">
      <span id="score" class="score">Pontua√ß√£o: 0</span>
      <span id="best" class="score">Recorde: 0</span>
    </div>
  </div>

  <canvas id="game"></canvas>

  <div class="help">
    Pulo em toque/clique/tecla. Passe no meio dos ‚Äúcanos vermelhos‚Äù (Marinakis + Forest).
    <div class="touch">
      <button id="flapBtn" class="btn">üïäÔ∏è Bater asa</button>
    </div>
  </div>
</div>

<script>
/* ================== Util ================== */
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const rand=(a,b)=>Math.random()*(b-a)+a;
function aabbInset(ax,ay,aw,ah, bx,by,bw,bh, inset){
  return (ax+inset) < (bx+bw-inset) &&
         (ax+aw-inset) > (bx+inset) &&
         (ay+inset) < (by+bh-inset) &&
         (ay+ah-inset) > (by+inset);
}
function loadImage(src){ return new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=src; }); }

/* ================== Setup ================== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const UI = {
  diff: document.getElementById('diff'),
  start: document.getElementById('start'),
  pause: document.getElementById('pause'),
  mute:  document.getElementById('mute'),
  flapBtn: document.getElementById('flapBtn'),
  score: document.getElementById('score'),
  best: document.getElementById('best'),
};
const UI_WRAP = document.querySelector('.wrap');

let state='menu'; 
let running=false, paused=false, last=0, assetsReady=false;

const world = { w:1280, h:720, groundH:84, gravity:1800, scroll:0 };
let SCALE=1;

/* ========== Responsivo ========== */
function fitCanvas(){
  const dpr = window.devicePixelRatio || 1;
  const cssW = Math.min(UI_WRAP.clientWidth, 1280);
  const cssH = Math.round(cssW * 9/16);
  canvas.style.width=cssW+'px'; canvas.style.height=cssH+'px';
  canvas.width=Math.round(cssW*dpr); canvas.height=Math.round(cssH*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  world.w=cssW; world.h=cssH;
  SCALE = world.h/720;
  world.groundH = Math.round(84*SCALE);
  world.gravity = 1800*SCALE;
  if(!running || paused || state!=='playing') draw(false);
}
window.addEventListener('resize', fitCanvas);

/* ========== Jogo ========= */
let bird=null, pipes=[], particles=[], powerups=[], turboTimer=0, score=0;
const birdBase = { w:56, h:56 };
let best = Number(localStorage.getItem('flap_best')||0);
UI.best.textContent = `Recorde: ${best}`;

/* ========== Assets ========= */
const ASSETS = { bird:null, marinakis:null, forest:null, bg:null, menu:null };
Promise.all([
  loadImage('botafogo.png'),
  loadImage('marinakis.png'),
  loadImage('nf.png'),
  loadImage('bgtextorfase.png'),
  loadImage('bg.png'),
]).then(([b,m,f,bg,menu])=>{
  ASSETS.bird=b; ASSETS.marinakis=m; ASSETS.forest=f; ASSETS.bg=bg; ASSETS.menu=menu;
  assetsReady=true; draw(false);
}).catch(()=>{ assetsReady=false; });

/* ========== √Åudio ========= */
let audioMuted=false, bgmUnlocked=false;
const SFX = {
  flap:  new Audio('sfx/flap.mp3'),
  point: new Audio('sfx/point.mp3'),
  hit:   new Audio('sfx/hit.mp3'),
};
Object.values(SFX).forEach(a=>{ a.preload='auto'; a.volume=0.8; });

const BGM = new Audio('music/theme.mp3');
BGM.loop=true; BGM.volume=0.35; BGM.preload='auto';

function unlockBGM(){
  if (bgmUnlocked) return;
  BGM.play().then(()=>{
    BGM.pause();
    BGM.currentTime=0;
    bgmUnlocked=true;
  }).catch(()=>{});
}
function playBGM(restart=false){
  if (audioMuted) return;
  if (restart) BGM.currentTime=0;
  BGM.play().catch(()=>{});
}
function setMuted(m){ audioMuted=m; BGM.muted=m; Object.values(SFX).forEach(a=>a.muted=m); UI.mute.textContent=m?'üîá Som: OFF':'üîä Som: ON'; }
function playSfx(a){ if(audioMuted) return; try{ a.currentTime=0; a.play(); }catch(e){} }

window.addEventListener('pointerdown', unlockBGM);
window.addEventListener('keydown', unlockBGM);

/* ========== Fluxo ========= */
function reset(){
  world.scroll=0; turboTimer=0;
  const bw=Math.round(birdBase.w*SCALE), bh=Math.round(birdBase.h*SCALE);
  bird = { x:Math.round(world.w*0.1875), y:world.h/2-Math.round(40*SCALE), w:bw, h:bh, vy:0, flap:520*SCALE, maxFall:900*SCALE };
  pipes=[]; particles=[]; powerups=[]; score=0;
  updateHUD();
}
function start(){ 
  reset(); state='playing'; running=true; paused=false; last=performance.now(); 
  unlockBGM(); playBGM(true); 
  requestAnimationFrame(loop); 
}
function goMenu(){ state='menu'; running=false; paused=false; draw(false); }
function pauseToggle(){
  if(state!=='playing') return;
  paused=!paused; state=paused?'paused':'playing';
  if (paused){ try{BGM.pause();}catch(e){}; draw(true); return; }
  unlockBGM(); playBGM(false);
  last=performance.now(); requestAnimationFrame(loop);
}
function gameOver(){ running=false; state='gameover'; try{BGM.pause();}catch(e){}; playSfx(SFX.hit); draw(true); }

/* ========== Entradas ========= */
function flapOrStart(){ if(state==='menu'){ start(); return; } if(state!=='playing') return; bird.vy=-bird.flap; playSfx(SFX.flap); }
window.addEventListener('keydown',(e)=>{ if(e.code==='Space'||e.code==='ArrowUp'||e.code==='Enter'){ e.preventDefault(); flapOrStart(); } else if(e.code==='KeyP'){ pauseToggle(); } });
canvas.addEventListener('mousedown', flapOrStart);
canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); flapOrStart(); }, {passive:false});
UI.flapBtn.addEventListener('click', flapOrStart);
UI.start.addEventListener('click', start);
UI.pause.addEventListener('click', pauseToggle);
UI.mute.addEventListener('click', ()=>setMuted(!audioMuted));

/* ========== Loop ========= */
function loop(ts){ if(!running || paused) return; const dt=Math.min(0.033,(ts-last)/1000); last=ts; update(dt); draw(false); requestAnimationFrame(loop); }

/* ========== Update/Draw simplificado (mostrando s√≥ fundo e p√°ssaro) ========== */
function update(dt){
  bird.vy = clamp(bird.vy + world.gravity*dt, -9999, bird.maxFall);
  bird.y  += bird.vy*dt;
  if(bird.y + bird.h > world.h-world.groundH){ bird.y=world.h-world.groundH-bird.h; gameOver(); }
}
function draw(){ 
  ctx.clearRect(0,0,world.w,world.h); 
  drawBackground(); 
  drawBird(); 
}
function drawBackground(){
  if(ASSETS.bg){
    const img=ASSETS.bg, dstW=world.w, dstH=world.h, iw=img.naturalWidth||img.width, ih=img.naturalHeight||img.height;
    const srcR=iw/ih, dstR=dstW/dstH; let w,h;
    if(srcR>dstR){ w=dstW; h=w/srcR; } else { h=dstH; w=h*srcR; }
    const x=(dstW-w)/2, y=(dstH-h)/2; ctx.drawImage(img,x,y,w,h);
  } else ctx.fillStyle='#0f1622', ctx.fillRect(0,0,world.w,world.h);
}
function drawBird(){ const cx=bird.x+bird.w/2, cy=bird.y+bird.h/2; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(cx,cy,20,0,Math.PI*2); ctx.fill(); }
function updateHUD(){ UI.score.textContent=`Pontua√ß√£o: ${score}`; UI.best.textContent=`Recorde: ${best}`; }

/* ========== Inicial ========= */
setMuted(false);
fitCanvas();
goMenu();
</script>
</body>
</html>
